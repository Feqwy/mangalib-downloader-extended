# MangaLib Downloader

Асинхронный загрузчик манги с MangaLib с поддержкой метаданных для Komga/Mylar.

![PoC](https://files.catbox.moe/udsxff.webp)

## Структура проекта

```
manga_downloader/
├── config.py          # Конфигурация приложения
├── colors.py          # Цветной вывод в консоль
├── models.py          # Модели данных
├── api_client.py      # API клиент для MangaLib
├── metadata.py        # Генерация метаданных (ComicInfo.xml, series.json)
├── downloader.py      # Основная логика скачивания
├── main.py            # Точка входа
├── requirements.txt   # Зависимости
└── README.md          # Документация
```

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Использование

Просто выполните:

```bash
python main.py
```

Программа предложит ввести:
```
Ссылку на мангу
Начальную главу
Конечную главу
Дополнительные главы (например: 0.5, 10.1, можно оставить пустым)
Название манги (Можно оставить по умолчанию)
Максимум одновременно загружаемых глав (Можно оставить по умолчанию)
Максимум одновременно загружаемых изображений (Можно оставить по умолчанию)
Задержку между запросами (Можно оставить по умолчанию)
```

После этого начнётся загрузка выбранных глав.

---

## Что можно настроить

- **Ссылка на мангу** — вставьте URL с сайта MangaLib.  
- **Диапазон глав** — укажите начальную и конечную главы для скачивания.
- **Дополнительные главы** — при необходимости добавьте главы вроде `0.5`, `10.1` и т.п.
- **Название манги** — можно задать своё имя для сохранённых архивов.  
- **Параллельность и задержки** — настройте количество одновременных загрузок и паузу между запросами для оптимального баланса скорости и стабильности.

---

## Структура выходных файлов

```
downloads/
└── Series_Name.zip
    └── Series_Name/
        ├── ComicInfo.xml          # Метаданные серии
        ├── series.json            # Метаданные для Komga/Mylar
        ├── cover.jpg              # Обложка серии (+ другие варианты)
        └── Volume 01/
            ├── ComicInfo.xml      # Метаданные тома
            ├── Chapter 001.cbz    # Глава в формате CBZ
            ├── Chapter 002.cbz
            └── ...
```

### Формат CBZ

Каждый файл `.cbz` содержит:
- Изображения страниц (001.jpg, 002.jpg, ...)
- `ComicInfo.xml` - метаданные главы
- `info.txt` - дополнительная информация в JSON

## Возможности

- Интерактивная CLI-настройка конфигурации (ввод параметров через консоль)
- Асинхронное скачивание с контролем параллелизма
- Поддержка **дробных глав и дополнительных `extra_chapters`**
- Автоматическое определение томов
- Обработка rate limits (429)
- Повторные попытки при ошибках
- Прогресс-бары для глав и страниц
- Метаданные для Komga/Mylar/Kavita
- Цветной вывод в консоль
- Модульная архитектура

## Примечания

- При высоких значениях `max_concurrent_*` возможны rate limits (429)
- Увеличьте `request_delay` если получаете ошибки 403/429
- Для корректной работы требуется стабильное интернет-соединение

## Troubleshooting

**Ошибка 429 (Too Many Requests)**
- Увеличьте `request_delay`
- Уменьшите `max_concurrent_images`

**Ошибка 403 (Forbidden)**
- Скрипт автоматически прогревает сессию
- Если проблема сохраняется, увеличьте `request_delay`

---

Этот инструмент предназначен только для образовательных целей. Пожалуйста, уважайте авторские права и условия использования MangaLib.